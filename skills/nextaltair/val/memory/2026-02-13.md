
## 2026-02-13 (compaction flush) - skills/runtime hardening summary

- Standardized Notion integration path to `notion-api-automation/notionctl` across active skills.
  - Removed direct/legacy Notion client files from `soul-in-sapphire` (`notion_client.js`, `notion_http.py/js`) and routed calls through notionctl bridge/common helpers.
  - Added generic `api` subcommand support to `skills/notion-api-automation/scripts/notionctl.mjs` for deterministic wrapper use.

- Completed JS-first unification for `soul-in-sapphire/scripts`.
  - Removed duplicate Python variants (`setup_ltm.py`, `emostate_tick.py`, plus remaining helper py files later) and replaced with `.js` equivalents.
  - Kept behavior parity and validated via runtime checks (ltm search/write/state recall/tick).

- Hardened workspace-move portability.
  - Updated scripts to avoid brittle cwd assumptions by preferring script-relative paths and/or OpenClaw config-derived workspace.
  - `calibre-catalog-read` state/cache/db defaults switched to skill-relative `state/` paths.

- Migrated `calibre-catalog-read` orchestration helpers to Node (`.mjs`).
  - Replaced `run_state.py`, `handle_completion.py`, `prepare_subagent_input.py` with `.mjs` implementations.

- Migrated `calibre-metadata-apply` runtime helpers to Node.
  - Replaced `run_state.py`, `handle_completion.py` with `.mjs`.
  - Fully migrated main apply engine from `calibredb_apply.py` to `calibredb_apply.mjs` (dry-run/apply, auth cache, analysis HTML/comments upsert, tag merge/remove parity).

- Auth best-practice decision adopted: centralize secrets in `/home/altair/.openclaw/.env`.
  - `CALIBRE_USERNAME` + `CALIBRE_PASSWORD` pattern now supported in `calibre-catalog-read` and `calibre-metadata-apply` flows.
  - Skill docs updated to prefer env-based auth and avoid embedding credentials in skill content.

- Operational verification performed:
  - `calibre-catalog-read` successfully ran real one-book pipeline updates (book ids 3 and 4) using env-based auth.
  - `calibre-metadata-apply` successfully updated real records (id 265, id 719) via dry-run then apply workflow.

- Repository event:
  - Committed `skills` repo changes for Node migration of `calibre-metadata-apply` with commit `908ef39`.

- External review lesson (ClawHub):
  - Main flagged issue was transparency mismatch: required Notion credentials/dependencies were not fully declared in package metadata.
  - Durable policy: ensure registry metadata explicitly declares required env vars/primary credential and local config reads/dependencies.

## 2026-02-13 (compaction flush 2) - ClawHub review alignment

- User requested fixing skill metadata/docs to match ClawHub security review findings.
- Updated `skills/soul-in-sapphire/SKILL.md` to explicitly declare credential/dependency/local-read transparency:
  - Required env: `NOTION_API_KEY` (primary credential)
  - Required binary: `node`
  - Depends on skill: `notion-api-automation` (executes `scripts/notionctl.mjs` via child process)
  - Local config reads documented: `~/.openclaw/openclaw.json`, `~/.config/soul-in-sapphire/config.json`
- Intent: remove mismatch between runtime behavior and registry metadata, improving installation trust/audit clarity.
