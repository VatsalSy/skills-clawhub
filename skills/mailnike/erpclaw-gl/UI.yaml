ocui_version: "1.0"
skill: erpclaw-gl
skill_version: "1.0.0"
display_name: General Ledger
icon: book-open
color: "#0ea5e9"

entities:
  account:
    label: Account
    label_plural: Accounts
    icon: file-text
    primary_field: name
    secondary_field: account_number
    identifier_field: id
    status_field: is_frozen
    status_colors:
      false: green
      true: red

    fields:
      id:
        type: text
        label: ID
        read_only: true
        in_detail_view: true

      name:
        type: text
        label: Account Name
        required: true
        max_length: 140
        searchable: true
        in_list_view: true
        in_form_view: true
        form_group: basic
        form_order: 1

      account_number:
        type: text
        label: Account Number
        max_length: 20
        searchable: true
        in_list_view: true
        in_form_view: true
        form_group: basic
        form_order: 2

      root_type:
        type: select
        label: Root Type
        required: true
        options:
          - { value: asset, label: Asset }
          - { value: liability, label: Liability }
          - { value: equity, label: Equity }
          - { value: income, label: Income }
          - { value: expense, label: Expense }
        in_list_view: true
        in_form_view: true
        form_group: basic
        form_order: 3

      account_type:
        type: select
        label: Account Type
        options:
          - { value: receivable, label: Receivable }
          - { value: payable, label: Payable }
          - { value: bank, label: Bank }
          - { value: cash, label: Cash }
          - { value: stock, label: Stock }
          - { value: tax, label: Tax }
          - { value: fixed_asset, label: Fixed Asset }
          - { value: depreciation, label: Depreciation }
          - { value: accumulated_depreciation, label: Accumulated Depreciation }
          - { value: cost_of_goods_sold, label: Cost of Goods Sold }
          - { value: income_account, label: Income Account }
          - { value: expense_account, label: Expense Account }
          - { value: equity, label: Equity }
          - { value: retained_earnings, label: Retained Earnings }
          - { value: round_off, label: Round Off }
        in_list_view: true
        in_form_view: true
        form_group: basic
        form_order: 4

      parent_id:
        type: link
        label: Parent Account
        link_entity: account
        link_display_field: name
        link_search_action: list-accounts
        in_form_view: true
        form_group: hierarchy
        form_order: 1

      is_group:
        type: boolean
        label: Is Group
        default: false
        help_text: "Group accounts cannot receive GL postings directly"
        in_list_view: true
        in_form_view: true
        form_group: hierarchy
        form_order: 2

      depth:
        type: integer
        label: Tree Depth
        read_only: true
        in_detail_view: true

      currency:
        type: currency_code
        label: Currency
        default: USD
        max_length: 3
        in_form_view: true
        form_group: basic
        form_order: 5

      balance_direction:
        type: select
        label: Balance Direction
        read_only: true
        options:
          - { value: debit_normal, label: Debit Normal }
          - { value: credit_normal, label: Credit Normal }
        in_detail_view: true

      is_frozen:
        type: boolean
        label: Frozen
        default: false
        read_only: true
        in_list_view: true
        in_detail_view: true

      disabled:
        type: boolean
        label: Disabled
        default: false
        read_only: true
        in_detail_view: true

      company_id:
        type: link
        label: Company
        required: true
        link_entity: company
        link_display_field: name
        link_search_action: list-companies
        in_form_view: true
        form_group: basic
        form_order: 6

      balance:
        type: currency
        label: Balance
        precision: 2
        read_only: true
        in_detail_view: true

      debit_total:
        type: currency
        label: Total Debits
        precision: 2
        read_only: true
        in_detail_view: true

      credit_total:
        type: currency
        label: Total Credits
        precision: 2
        read_only: true
        in_detail_view: true

      created_at:
        type: datetime
        label: Created
        read_only: true
        in_detail_view: true

      updated_at:
        type: datetime
        label: Last Updated
        read_only: true
        in_detail_view: true

    form_groups:
      basic:
        label: Account Information
        order: 1
        columns: 2
      hierarchy:
        label: Hierarchy
        order: 2
        columns: 2
        collapsible: true

    views:
      list:
        columns:
          - { field: account_number, width: 100, link: true }
          - { field: name, width: 220, link: true }
          - { field: root_type, width: 100 }
          - { field: account_type, width: 140 }
          - { field: is_group, width: 80 }
          - { field: is_frozen, width: 80 }
        filters:
          - { field: root_type, type: select }
          - { field: account_type, type: select }
          - { field: is_group, type: select }
        row_click: get-account

      detail:
        header:
          title_field: name
          subtitle_field: account_number
          status_field: is_frozen
        sections:
          - label: Account Information
            fields: [name, account_number, root_type, account_type, currency, balance_direction, company_id]
            columns: 3
          - label: Hierarchy
            fields: [parent_id, is_group, depth]
            columns: 3
          - label: Balance
            fields: [balance, debit_total, credit_total]
            columns: 3
          - label: Status
            fields: [is_frozen, disabled, created_at, updated_at]
            columns: 2
            collapsible: true
        actions:
          - { action: update-account, label: Edit }
          - { action: freeze-account, label: Freeze, destructive: true }
          - { action: unfreeze-account, label: Unfreeze }
          - { action: get-account-balance, label: Check Balance }

  gl_entry:
    label: GL Entry
    label_plural: GL Entries
    icon: list
    primary_field: voucher_type
    secondary_field: posting_date
    identifier_field: id

    fields:
      id:
        type: text
        label: ID
        read_only: true
        in_detail_view: true

      posting_date:
        type: date
        label: Posting Date
        required: true
        in_list_view: true
        in_detail_view: true

      account_id:
        type: link
        label: Account
        required: true
        link_entity: account
        link_display_field: name
        link_search_action: list-accounts
        in_list_view: true
        in_detail_view: true

      account_name:
        type: text
        label: Account Name
        read_only: true
        in_list_view: true

      debit:
        type: currency
        label: Debit
        precision: 2
        required: true
        default: "0"
        in_list_view: true
        in_detail_view: true

      credit:
        type: currency
        label: Credit
        precision: 2
        required: true
        default: "0"
        in_list_view: true
        in_detail_view: true

      debit_base:
        type: currency
        label: Debit (Base)
        precision: 2
        read_only: true
        in_detail_view: true

      credit_base:
        type: currency
        label: Credit (Base)
        precision: 2
        read_only: true
        in_detail_view: true

      currency:
        type: currency_code
        label: Currency
        read_only: true
        in_detail_view: true

      exchange_rate:
        type: decimal
        label: Exchange Rate
        precision: 6
        read_only: true
        in_detail_view: true

      voucher_type:
        type: text
        label: Voucher Type
        required: true
        in_list_view: true
        in_detail_view: true

      voucher_id:
        type: text
        label: Voucher ID
        required: true
        in_list_view: true
        in_detail_view: true

      party_type:
        type: select
        label: Party Type
        options:
          - { value: customer, label: Customer }
          - { value: supplier, label: Supplier }
          - { value: employee, label: Employee }
        in_detail_view: true

      party_id:
        type: text
        label: Party ID
        in_detail_view: true

      cost_center_id:
        type: link
        label: Cost Center
        link_entity: cost_center
        link_display_field: name
        link_search_action: list-cost-centers
        in_detail_view: true

      fiscal_year:
        type: text
        label: Fiscal Year
        read_only: true
        in_detail_view: true

      remarks:
        type: text
        label: Remarks
        read_only: true
        in_list_view: true
        in_detail_view: true

      is_cancelled:
        type: boolean
        label: Cancelled
        default: false
        read_only: true
        in_list_view: true
        in_detail_view: true

      is_opening:
        type: boolean
        label: Opening Entry
        default: false
        read_only: true
        in_detail_view: true

      gl_checksum:
        type: text
        label: GL Checksum
        read_only: true
        in_detail_view: true

      created_at:
        type: datetime
        label: Created
        read_only: true
        in_detail_view: true

    form_groups: {}

    views:
      list:
        columns:
          - { field: posting_date, width: 110 }
          - { field: account_name, width: 200 }
          - { field: debit, width: 120, align: right }
          - { field: credit, width: 120, align: right }
          - { field: voucher_type, width: 130 }
          - { field: voucher_id, width: 140 }
          - { field: remarks, width: 180 }
          - { field: is_cancelled, width: 80 }
        filters:
          - { field: voucher_type, type: text }
          - { field: posting_date, type: date_range }
          - { field: is_cancelled, type: select }
          - { field: account_id, type: link, link_entity: account, link_search_action: list-accounts }

      detail:
        header:
          title_field: voucher_type
          subtitle_field: posting_date
        sections:
          - label: Entry Details
            fields: [posting_date, account_id, account_name, voucher_type, voucher_id, fiscal_year]
            columns: 3
          - label: Amounts
            fields: [debit, credit, debit_base, credit_base, currency, exchange_rate]
            columns: 3
          - label: Party
            fields: [party_type, party_id, cost_center_id]
            columns: 3
            collapsible: true
          - label: Metadata
            fields: [is_cancelled, is_opening, remarks, gl_checksum, created_at]
            columns: 2
            collapsible: true

  fiscal_year:
    label: Fiscal Year
    label_plural: Fiscal Years
    icon: calendar
    primary_field: name
    secondary_field: start_date
    identifier_field: id
    status_field: is_closed
    status_colors:
      false: green
      true: gray

    fields:
      id:
        type: text
        label: ID
        read_only: true
        in_detail_view: true

      name:
        type: text
        label: Name
        required: true
        max_length: 140
        placeholder: "e.g., FY 2026"
        searchable: true
        in_list_view: true
        in_form_view: true
        form_group: basic
        form_order: 1

      start_date:
        type: date
        label: Start Date
        required: true
        in_list_view: true
        in_form_view: true
        form_group: basic
        form_order: 2

      end_date:
        type: date
        label: End Date
        required: true
        in_list_view: true
        in_form_view: true
        form_group: basic
        form_order: 3

      is_closed:
        type: boolean
        label: Closed
        default: false
        read_only: true
        in_list_view: true
        in_detail_view: true

      company_id:
        type: link
        label: Company
        required: true
        link_entity: company
        link_display_field: name
        link_search_action: list-companies
        in_list_view: true
        in_form_view: true
        form_group: basic
        form_order: 4

      created_at:
        type: datetime
        label: Created
        read_only: true
        in_detail_view: true

      updated_at:
        type: datetime
        label: Last Updated
        read_only: true
        in_detail_view: true

    form_groups:
      basic:
        label: Fiscal Year Details
        order: 1
        columns: 2

    views:
      list:
        columns:
          - { field: name, width: 180, link: true }
          - { field: start_date, width: 120 }
          - { field: end_date, width: 120 }
          - { field: is_closed, width: 80 }
          - { field: company_id, width: 160 }
        filters:
          - { field: is_closed, type: select }
        row_click: get-fiscal-year

      detail:
        header:
          title_field: name
          subtitle_field: company_id
          status_field: is_closed
        sections:
          - label: Fiscal Year Details
            fields: [name, start_date, end_date, is_closed, company_id]
            columns: 3
          - label: Metadata
            fields: [created_at, updated_at]
            columns: 2
            collapsible: true
        actions:
          - { action: validate-period-close, label: Validate for Closing }
          - { action: close-fiscal-year, label: Close Year, destructive: true }
          - { action: reopen-fiscal-year, label: Reopen Year, destructive: true }

  cost_center:
    label: Cost Center
    label_plural: Cost Centers
    icon: target
    primary_field: name
    identifier_field: id

    fields:
      id:
        type: text
        label: ID
        read_only: true
        in_detail_view: true

      name:
        type: text
        label: Name
        required: true
        max_length: 140
        searchable: true
        in_list_view: true
        in_form_view: true
        form_group: basic
        form_order: 1

      parent_id:
        type: link
        label: Parent Cost Center
        link_entity: cost_center
        link_display_field: name
        link_search_action: list-cost-centers
        in_list_view: true
        in_form_view: true
        form_group: basic
        form_order: 2

      is_group:
        type: boolean
        label: Is Group
        default: false
        help_text: "Group cost centers contain sub-cost-centers"
        in_list_view: true
        in_form_view: true
        form_group: basic
        form_order: 3

      company_id:
        type: link
        label: Company
        required: true
        link_entity: company
        link_display_field: name
        link_search_action: list-companies
        in_form_view: true
        form_group: basic
        form_order: 4

      created_at:
        type: datetime
        label: Created
        read_only: true
        in_detail_view: true

      updated_at:
        type: datetime
        label: Last Updated
        read_only: true
        in_detail_view: true

    form_groups:
      basic:
        label: Cost Center Details
        order: 1
        columns: 2

    views:
      list:
        columns:
          - { field: name, width: 220, link: true }
          - { field: parent_id, width: 180 }
          - { field: is_group, width: 80 }
        filters:
          - { field: is_group, type: select }
          - { field: parent_id, type: link, link_entity: cost_center, link_search_action: list-cost-centers }

      detail:
        header:
          title_field: name
        sections:
          - label: Cost Center Details
            fields: [name, parent_id, is_group, company_id]
            columns: 2
          - label: Metadata
            fields: [created_at, updated_at]
            columns: 2
            collapsible: true

  budget:
    label: Budget
    label_plural: Budgets
    icon: pie-chart
    primary_field: budget_amount
    identifier_field: id

    fields:
      id:
        type: text
        label: ID
        read_only: true
        in_detail_view: true

      fiscal_year_id:
        type: link
        label: Fiscal Year
        required: true
        link_entity: fiscal_year
        link_display_field: name
        link_search_action: list-fiscal-years
        in_list_view: true
        in_form_view: true
        form_group: basic
        form_order: 1

      account_id:
        type: link
        label: Account
        link_entity: account
        link_display_field: name
        link_search_action: list-accounts
        help_text: "At least one of Account or Cost Center is required"
        in_list_view: true
        in_form_view: true
        form_group: basic
        form_order: 2

      cost_center_id:
        type: link
        label: Cost Center
        link_entity: cost_center
        link_display_field: name
        link_search_action: list-cost-centers
        help_text: "At least one of Account or Cost Center is required"
        in_list_view: true
        in_form_view: true
        form_group: basic
        form_order: 3

      budget_amount:
        type: currency
        label: Budget Amount
        precision: 2
        required: true
        min: "0"
        in_list_view: true
        in_form_view: true
        form_group: basic
        form_order: 4

      actual_amount:
        type: currency
        label: Actual Amount
        precision: 2
        read_only: true
        in_list_view: true
        in_detail_view: true

      variance:
        type: currency
        label: Variance
        precision: 2
        read_only: true
        in_list_view: true
        in_detail_view: true

      action_if_exceeded:
        type: select
        label: Action If Exceeded
        options:
          - { value: warn, label: Warn }
          - { value: stop, label: Stop }
        default: warn
        in_list_view: true
        in_form_view: true
        form_group: basic
        form_order: 5

      company_id:
        type: link
        label: Company
        read_only: true
        link_entity: company
        link_display_field: name
        link_search_action: list-companies
        in_detail_view: true

      created_at:
        type: datetime
        label: Created
        read_only: true
        in_detail_view: true

      updated_at:
        type: datetime
        label: Last Updated
        read_only: true
        in_detail_view: true

    form_groups:
      basic:
        label: Budget Details
        order: 1
        columns: 2

    views:
      list:
        columns:
          - { field: fiscal_year_id, width: 140 }
          - { field: account_id, width: 180 }
          - { field: cost_center_id, width: 160 }
          - { field: budget_amount, width: 130, align: right }
          - { field: actual_amount, width: 130, align: right }
          - { field: variance, width: 130, align: right }
          - { field: action_if_exceeded, width: 100 }
        filters:
          - { field: fiscal_year_id, type: link, link_entity: fiscal_year, link_search_action: list-fiscal-years }
          - { field: action_if_exceeded, type: select }

      detail:
        header:
          title_field: budget_amount
          subtitle_field: fiscal_year_id
        sections:
          - label: Budget Details
            fields: [fiscal_year_id, account_id, cost_center_id, budget_amount, action_if_exceeded, company_id]
            columns: 2
          - label: Actuals
            fields: [actual_amount, variance]
            columns: 2
          - label: Metadata
            fields: [created_at, updated_at]
            columns: 2
            collapsible: true

  naming_series:
    label: Naming Series
    label_plural: Naming Series
    icon: hash
    primary_field: entity_type
    secondary_field: prefix
    identifier_field: id

    fields:
      id:
        type: text
        label: ID
        read_only: true
        in_detail_view: true

      entity_type:
        type: text
        label: Entity Type
        required: true
        in_list_view: true
        in_detail_view: true

      prefix:
        type: text
        label: Prefix
        required: true
        help_text: "e.g., INV-2026-, JV-2026-"
        in_list_view: true
        in_detail_view: true

      current_value:
        type: integer
        label: Current Value
        read_only: true
        in_list_view: true
        in_detail_view: true

      company_id:
        type: link
        label: Company
        required: true
        link_entity: company
        link_display_field: name
        link_search_action: list-companies
        in_detail_view: true

      created_at:
        type: datetime
        label: Created
        read_only: true
        in_detail_view: true

    form_groups: {}

    views:
      list:
        columns:
          - { field: entity_type, width: 160 }
          - { field: prefix, width: 160 }
          - { field: current_value, width: 120, align: right }
        filters:
          - { field: entity_type, type: text }

  period_closing_voucher:
    label: Period Closing Voucher
    label_plural: Period Closing Vouchers
    icon: lock
    primary_field: fiscal_year_id
    secondary_field: posting_date
    identifier_field: id
    status_field: status
    status_colors:
      submitted: green
      cancelled: red

    fields:
      id:
        type: text
        label: ID
        read_only: true
        in_detail_view: true

      fiscal_year_id:
        type: link
        label: Fiscal Year
        required: true
        link_entity: fiscal_year
        link_display_field: name
        link_search_action: list-fiscal-years
        in_list_view: true
        in_detail_view: true

      posting_date:
        type: date
        label: Posting Date
        required: true
        in_list_view: true
        in_detail_view: true

      closing_account_id:
        type: link
        label: Closing Account (Retained Earnings)
        required: true
        link_entity: account
        link_display_field: name
        link_search_action: list-accounts
        in_list_view: true
        in_detail_view: true

      net_pl_amount:
        type: currency
        label: Net P&L Amount
        precision: 2
        read_only: true
        in_list_view: true
        in_detail_view: true

      status:
        type: status
        label: Status
        read_only: true
        in_list_view: true
        in_detail_view: true

      company_id:
        type: link
        label: Company
        read_only: true
        link_entity: company
        link_display_field: name
        link_search_action: list-companies
        in_detail_view: true

      created_at:
        type: datetime
        label: Created
        read_only: true
        in_detail_view: true

      updated_at:
        type: datetime
        label: Last Updated
        read_only: true
        in_detail_view: true

    form_groups: {}

    views:
      list:
        columns:
          - { field: fiscal_year_id, width: 160 }
          - { field: posting_date, width: 120 }
          - { field: closing_account_id, width: 200 }
          - { field: net_pl_amount, width: 140, align: right }
          - { field: status, width: 100 }

      detail:
        header:
          title_field: fiscal_year_id
          subtitle_field: posting_date
          status_field: status
        sections:
          - label: Voucher Details
            fields: [fiscal_year_id, posting_date, closing_account_id, net_pl_amount, status, company_id]
            columns: 2
          - label: Metadata
            fields: [created_at, updated_at]
            columns: 2
            collapsible: true

action_map:
  # -----------------------------------------------------------------------
  # Chart of Accounts actions (7)
  # -----------------------------------------------------------------------
  setup-chart-of-accounts:
    component: WizardFlow
    entity: account
    steps:
      - label: Select Template
        fields:
          - name: template
            type: select
            label: Chart of Accounts Template
            required: true
            default: us_gaap
            options:
              - { value: us_gaap, label: "US GAAP (Full ~90 accounts)" }
              - { value: us_gaap_simplified, label: "US GAAP Simplified (~40 accounts)" }
          - name: company_id
            type: link
            label: Company
            required: true
            link_entity: company
            link_display_field: name
            link_search_action: list-companies
      - label: Confirm
        confirmation: true
        message: "This will load the selected chart of accounts template. Existing accounts will not be duplicated."
    success_redirect: list-accounts
    success_toast: "Chart of accounts loaded: {accounts_created} accounts created"

  add-account:
    component: FormView
    entity: account
    mode: create
    success_redirect: get-account
    success_toast: "Account '{name}' created"

  update-account:
    component: FormView
    entity: account
    mode: edit
    success_redirect: get-account
    success_toast: "Account updated"

  list-accounts:
    component: DataTable
    entity: account
    default_sort: account_number
    searchable: true
    add_action: add-account
    extra_actions:
      - { action: setup-chart-of-accounts, label: Load Template, icon: upload }

  get-account:
    component: DetailView
    entity: account

  freeze-account:
    component: WizardFlow
    entity: account
    steps:
      - label: Confirm Freeze
        confirmation: true
        message: "Freezing this account will prevent any new GL postings. Are you sure?"
        fields:
          - name: account_id
            type: link
            label: Account
            required: true
            link_entity: account
            link_display_field: name
            link_search_action: list-accounts
    success_redirect: get-account
    success_toast: "Account frozen"

  unfreeze-account:
    component: FormView
    entity: account
    mode: action
    fields:
      - name: account_id
        type: link
        label: Account
        required: true
        link_entity: account
        link_display_field: name
        link_search_action: list-accounts
    success_redirect: get-account
    success_toast: "Account unfrozen"

  # -----------------------------------------------------------------------
  # GL Entry actions (4)
  # -----------------------------------------------------------------------
  post-gl-entries:
    component: WizardFlow
    entity: gl_entry
    steps:
      - label: Voucher Details
        fields:
          - name: voucher_type
            type: text
            label: Voucher Type
            required: true
          - name: voucher_id
            type: text
            label: Voucher ID
            required: true
          - name: posting_date
            type: date
            label: Posting Date
            required: true
            default: today
          - name: company_id
            type: link
            label: Company
            required: true
            link_entity: company
            link_display_field: name
            link_search_action: list-companies
      - label: GL Entries
        fields:
          - name: entries
            type: json
            label: Entries (JSON array)
            required: true
            help_text: 'Each entry: {"account_id": "...", "debit": "0", "credit": "100.00"}'
      - label: Review
        confirmation: true
        message: "GL entries must balance: SUM(debits) = SUM(credits). Confirm posting?"
    success_toast: "GL entries posted: {entries_created} entries created"

  reverse-gl-entries:
    component: WizardFlow
    entity: gl_entry
    steps:
      - label: Select Voucher
        fields:
          - name: voucher_type
            type: text
            label: Voucher Type
            required: true
          - name: voucher_id
            type: text
            label: Voucher ID
            required: true
          - name: posting_date
            type: date
            label: Reversal Date
            default: today
      - label: Confirm Reversal
        confirmation: true
        message: "This will create reversing GL entries for the selected voucher. This action cannot be undone."
    success_toast: "GL entries reversed: {reversed_count} reversal entries created"

  list-gl-entries:
    component: DataTable
    entity: gl_entry
    default_sort: posting_date
    default_sort_dir: desc
    searchable: false
    paginated: true
    page_size: 50

  check-gl-integrity:
    component: DashboardView
    entity: gl_entry
    fields:
      - name: company_id
        type: link
        label: Company
        required: true
        link_entity: company
        link_display_field: name
        link_search_action: list-companies
    display:
      - { key: balanced, label: "GL Balanced", type: boolean_badge, true_label: Balanced, false_label: OUT OF BALANCE }
      - { key: total_debit, label: "Total Debits", type: currency }
      - { key: total_credit, label: "Total Credits", type: currency }
      - { key: difference, label: "Difference", type: currency }
      - { key: chain_intact, label: "Hash Chain Intact", type: boolean_badge, true_label: Intact, false_label: BROKEN }
      - { key: broken_links, label: "Broken Links", type: integer }
      - { key: total_entries, label: "Total Entries", type: integer }

  # -----------------------------------------------------------------------
  # Fiscal Year actions (5)
  # -----------------------------------------------------------------------
  add-fiscal-year:
    component: FormView
    entity: fiscal_year
    mode: create
    success_toast: "Fiscal year '{name}' created"

  list-fiscal-years:
    component: DataTable
    entity: fiscal_year
    default_sort: start_date
    default_sort_dir: desc
    searchable: true
    add_action: add-fiscal-year

  validate-period-close:
    component: DashboardView
    entity: fiscal_year
    fields:
      - name: fiscal_year_id
        type: link
        label: Fiscal Year
        required: true
        link_entity: fiscal_year
        link_display_field: name
        link_search_action: list-fiscal-years
    display:
      - { key: fiscal_year, label: "Fiscal Year", type: text }
      - { key: income_total, label: "Income Total", type: currency }
      - { key: expense_total, label: "Expense Total", type: currency }
      - { key: net_income, label: "Net Income", type: currency }
      - { key: trial_balance_balanced, label: "Trial Balance Balanced", type: boolean_badge, true_label: Balanced, false_label: NOT BALANCED }

  close-fiscal-year:
    component: WizardFlow
    entity: fiscal_year
    steps:
      - label: Closing Parameters
        fields:
          - name: fiscal_year_id
            type: link
            label: Fiscal Year
            required: true
            link_entity: fiscal_year
            link_display_field: name
            link_search_action: list-fiscal-years
          - name: closing_account_id
            type: link
            label: Closing Account (Retained Earnings)
            required: true
            link_entity: account
            link_display_field: name
            link_search_action: list-accounts
            help_text: "Must be an equity account (e.g., Retained Earnings)"
          - name: posting_date
            type: date
            label: Closing Date
            required: true
      - label: Confirm Close
        confirmation: true
        message: "Closing a fiscal year will transfer net P&L to Retained Earnings and mark the year as closed. This is a significant action."
    success_toast: "Fiscal year closed. Net P&L of {net_pl_transferred} transferred."

  reopen-fiscal-year:
    component: WizardFlow
    entity: fiscal_year
    steps:
      - label: Select Fiscal Year
        fields:
          - name: fiscal_year_id
            type: link
            label: Fiscal Year
            required: true
            link_entity: fiscal_year
            link_display_field: name
            link_search_action: list-fiscal-years
      - label: Confirm Reopen
        confirmation: true
        message: "Reopening a fiscal year will cancel the period closing voucher and reverse all closing GL entries. Are you sure?"
    success_toast: "Fiscal year reopened"

  # -----------------------------------------------------------------------
  # Cost Center actions (2)
  # -----------------------------------------------------------------------
  add-cost-center:
    component: FormView
    entity: cost_center
    mode: create
    success_toast: "Cost center '{name}' created"

  list-cost-centers:
    component: DataTable
    entity: cost_center
    default_sort: name
    searchable: true
    add_action: add-cost-center

  # -----------------------------------------------------------------------
  # Budget actions (2)
  # -----------------------------------------------------------------------
  add-budget:
    component: FormView
    entity: budget
    mode: create
    success_toast: "Budget created"

  list-budgets:
    component: DataTable
    entity: budget
    default_sort: budget_amount
    default_sort_dir: desc
    paginated: true

  # -----------------------------------------------------------------------
  # Naming Series actions (2)
  # -----------------------------------------------------------------------
  seed-naming-series:
    component: WizardFlow
    entity: naming_series
    steps:
      - label: Select Company
        fields:
          - name: company_id
            type: link
            label: Company
            required: true
            link_entity: company
            link_display_field: name
            link_search_action: list-companies
      - label: Confirm
        confirmation: true
        message: "This will seed naming series for all entity types for the current year. Existing series will not be duplicated."
    success_toast: "Naming series seeded: {series_created} created"

  next-series:
    component: FormView
    entity: naming_series
    mode: action
    fields:
      - name: entity_type
        type: text
        label: Entity Type
        required: true
        help_text: "e.g., journal_entry, payment_entry, sales_invoice"
      - name: company_id
        type: link
        label: Company
        required: true
        link_entity: company
        link_display_field: name
        link_search_action: list-companies
    success_toast: "Next series: {series}"

  # -----------------------------------------------------------------------
  # System / Balance actions (3)
  # -----------------------------------------------------------------------
  get-account-balance:
    component: DashboardView
    entity: account
    fields:
      - name: account_id
        type: link
        label: Account
        required: true
        link_entity: account
        link_display_field: name
        link_search_action: list-accounts
      - name: as_of_date
        type: date
        label: As-of Date
        required: true
        default: today
      - name: party_type
        type: select
        label: Party Type
        options:
          - { value: customer, label: Customer }
          - { value: supplier, label: Supplier }
          - { value: employee, label: Employee }
      - name: party_id
        type: text
        label: Party ID
    display:
      - { key: balance, label: "Balance", type: currency }
      - { key: debit_total, label: "Total Debits", type: currency }
      - { key: credit_total, label: "Total Credits", type: currency }
      - { key: currency, label: "Currency", type: text }

  status:
    component: DashboardView
    entity: null
    fields:
      - name: company_id
        type: link
        label: Company (optional)
        link_entity: company
        link_display_field: name
        link_search_action: list-companies
    display:
      - { key: companies, label: "Companies", type: integer }
      - { key: accounts, label: "Accounts", type: integer }
      - { key: fiscal_years, label: "Fiscal Years", type: integer }
      - { key: gl_entries, label: "GL Entries", type: integer }
      - { key: latest_posting_date, label: "Latest Posting", type: date }

  # -----------------------------------------------------------------------
  # FX Revaluation action (1)
  # -----------------------------------------------------------------------
  revalue-foreign-balances:
    component: WizardFlow
    entity: gl_entry
    steps:
      - label: Revaluation Parameters
        fields:
          - name: company_id
            type: link
            label: Company
            required: true
            link_entity: company
            link_display_field: name
            link_search_action: list-companies
          - name: as_of_date
            type: date
            label: As-of Date
            required: true
            default: today
      - label: Confirm Revaluation
        confirmation: true
        message: "This will post unrealized FX gain/loss entries for all foreign currency accounts. Review results carefully."
    success_toast: "FX revaluation complete: {accounts_processed} accounts processed, total gain/loss {total_gain_loss}"

  # -----------------------------------------------------------------------
  # CSV Import actions (2)
  # -----------------------------------------------------------------------
  import-chart-of-accounts:
    component: WizardFlow
    entity: account
    steps:
      - label: Import Settings
        fields:
          - name: csv_path
            type: text
            label: CSV File Path
            required: true
            help_text: "Absolute path to the CSV file on the server"
          - name: company_id
            type: link
            label: Company
            required: true
            link_entity: company
            link_display_field: name
            link_search_action: list-companies
      - label: Confirm Import
        confirmation: true
        message: "This will import accounts from the CSV file. Duplicate account names will be skipped."
    success_redirect: list-accounts
    success_toast: "Import complete: {imported} accounts imported, {skipped} skipped"

  import-opening-balances:
    component: WizardFlow
    entity: gl_entry
    steps:
      - label: Import Settings
        fields:
          - name: csv_path
            type: text
            label: CSV File Path
            required: true
            help_text: "Absolute path to the CSV file on the server"
          - name: company_id
            type: link
            label: Company
            required: true
            link_entity: company
            link_display_field: name
            link_search_action: list-companies
          - name: posting_date
            type: date
            label: Opening Balance Date
            required: true
            help_text: "Typically the day before the first day of the new fiscal year"
      - label: Confirm Import
        confirmation: true
        message: "This will post opening balance GL entries from the CSV file. Ensure debits equal credits."
    success_toast: "Opening balances imported: {gl_entries_created} GL entries created"
